

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Testing in ODL &mdash; odl 1.0.0.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The ODL release process" href="release.html" />
    <link rel="prev" title="How to document" href="document.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> odl
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with ODL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/guide.html">User’s guide – selected topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/math.html">Mathematical Background</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer zone</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="dev.html">Contributing to ODL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev.html#introduction">Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="dev.html#contents">Contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="extend.html">Extending ODL</a></li>
<li class="toctree-l3"><a class="reference internal" href="document.html">How to document</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Testing in ODL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#large-scale">Large-scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#doctests">Doctests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="release.html">The ODL release process</a></li>
<li class="toctree-l3"><a class="reference internal" href="gitwash/index.html">Working with ODL source code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Useful facts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../odl.html">odl</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">odl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="dev.html">Contributing to ODL</a> &raquo;</li>
        
      <li>Testing in ODL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/dev/testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-in-odl">
<span id="dev-testing"></span><h1>Testing in ODL<a class="headerlink" href="#testing-in-odl" title="Permalink to this headline">¶</a></h1>
<p>ODL tests are run using <a class="reference external" href="http://doc.pytest.org/en/latest/">pytest</a>, and there are several types:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 28%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Command</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Unit tests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code></p></td>
<td><p>Test “micro-features” of the code</p></td>
</tr>
<tr class="row-odd"><td><p>Large-scale</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-S</span> <span class="pre">largescale</span></code></p></td>
<td><p>Unit tests with large inputs and more cases</p></td>
</tr>
<tr class="row-even"><td><p>Doctests</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code></p></td>
<td><p>Validate usage examples in docstrings</p></td>
</tr>
<tr class="row-odd"><td><p>Examples</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-S</span> <span class="pre">examples</span></code></p></td>
<td><p>Run all examples in the <a class="reference external" href="https://github.com/odlgroup/odl/tree/master/examples">examples</a> folder</p></td>
</tr>
<tr class="row-even"><td><p>Documentation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-S</span> <span class="pre">doc_doctests</span></code></p></td>
<td><p>Run the doctest examples in the Sphinx documentation</p></td>
</tr>
</tbody>
</table>
<div class="section" id="unit-tests">
<h2>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>All unit tests in ODL are contained in the <a class="reference external" href="https://github.com/odlgroup/odl/tree/master/odl/test">test</a> folder, where each sub-package has a test file on its own.
Any major ODL functionality should have unit tests covering all of the use cases that are implied in the documentation.
In addition to this, the tests should be quick to run, preferably at most a few milliseconds per test.
If the test suite takes too long to run, users and developers won’t run them as often as necessary to make sure that they didn’t break any functionality.</p>
<p>A short example of testing a function is given below.
For more information consult the <a class="reference external" href="http://doc.pytest.org/en/latest/">pytest</a> documentation and look at existing tests in the <a class="reference external" href="https://github.com/odlgroup/odl/tree/master/odl/test">test</a> folder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert ``x`` to a integer and add 1.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">test_myfunction</span><span class="p">():</span>
    <span class="c1"># Test basic functionality</span>
    <span class="k">assert</span> <span class="n">myfunction</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">myfunction</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span>
    <span class="k">assert</span> <span class="n">myfunction</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span>

    <span class="c1"># Test when called with float</span>
    <span class="k">assert</span> <span class="n">myfunction</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c1"># Test when called with string</span>
    <span class="k">assert</span> <span class="n">myfunction</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c1"># Verify that bad input throws a proper error</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">myfunction</span><span class="p">([])</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">myfunction</span><span class="p">(</span><span class="s1">&#39;non-integer&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">myfunction</span><span class="p">(</span><span class="nb">object</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">OverflowError</span><span class="p">):</span>
        <span class="n">myfunction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="large-scale">
<h2>Large-scale<a class="headerlink" href="#large-scale" title="Permalink to this headline">¶</a></h2>
<p>Large-scale test verify that functions work well even in realistic conditions and with an even wider range of input than in the standard unit tests.
They live in the <code class="docutils literal notranslate"><span class="pre">largescale</span></code> subfolder of the <a class="reference external" href="https://github.com/odlgroup/odl/tree/master/odl/test">test</a> folder.
Not all functionality needs largescale tests, in fact, most doesn’t.
This type of test makes most sense for (1) functionality that has a complex implementation where it’s easy to make mistakes that the code slow (regression tests) and (2) features that take too much time to be tested broadly in the standard suite.
For the second type, the unit tests should include only a couple of tests that can run fast, and the full range of inputs can be tested in the large-scale suite.</p>
<p>It may also be the case that some functions accept a very large number of possible input configurations, in this case, testing the most common configuration in the regular unittest and testing the others in a largescale test is acceptable.</p>
</div>
<div class="section" id="doctests">
<h2>Doctests<a class="headerlink" href="#doctests" title="Permalink to this headline">¶</a></h2>
<p>Doctests are the simplest type of test used in ODL, and are snippets of code that document the usage of functions and classes and can be run as small tests at the same time.
They can be included by using the Examples header in an usual docstring, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfunction</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert ``x`` to a integer and add 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    For integers, the function simply adds 1:</span>

<span class="sd">    &gt;&gt;&gt; myfunction(1)</span>
<span class="sd">    2</span>

<span class="sd">    The function also works with floats:</span>

<span class="sd">    &gt;&gt;&gt; myfunction(1.3)</span>
<span class="sd">    2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Despite simply looking like documentation, doctests are actual pieces of python code and will be executed when the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command is invoked.
See the <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.9)"><code class="xref any docutils literal notranslate"><span class="pre">doctest</span></code></a> documentation for more information.</p>
<p>All ODL source files should also contain the lines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">odl.util.testutils</span> <span class="kn">import</span> <span class="n">run_doctests</span>
    <span class="n">run_doctests</span><span class="p">()</span>
</pre></div>
</div>
<p>which mean that if a ODL source file is executed in isolation, all the doctests in the file are run.
This can be useful during development in order to quickly see if some functionality works as expected.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Examples, while not technically tests in the traditional sense, still constitute a part of the test framework for ODL by showing how different parts of ODL work together and by ensuring that functions that depend on each other work as expected.
The main purpose of the examples is however to show ODL from a users perspective and particular care should be taken to keep them readable and working since this is often the first thing users see when they start using ODL.</p>
<p>It is even possible to run all examples as part of the test suite by running <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-S</span> <span class="pre">examples</span></code>, but be aware that this requires all ODL dependencies to be installed and can take a long time.</p>
<p>Consult the <a class="reference external" href="https://github.com/odlgroup/odl/tree/master/examples">examples</a> directory for an impression of the style in which ODL examples are written.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="release.html" class="btn btn-neutral float-right" title="The ODL release process" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="document.html" class="btn btn-neutral float-left" title="How to document" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2014-2020 The ODL Contributors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>